<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - School Management System</title>
    <link rel="stylesheet" href="/css/admin.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" />
    <style>
      .stat-card {
        background: #fff;
        border-radius: 1rem;
        color: #000;
        padding: 2rem 1.5rem;
        text-align: center;
        margin-bottom: 1.5rem;
        transition: box-shadow 0.2s;
      }
     
      .notice-card {
        background: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 1px 4px rgba(26,35,126,0.06);
        padding: 1rem 1.25rem;
        margin-bottom: 1rem;
      }
      .notice-title {
        font-weight: 600;
        font-size: 1.1rem;
        color: #1a1a23;
      }

      .notice-content{
        font-size: 1.1rem;
        color: #000;
      }
      
      .data-table, .leave-table {
        background: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 1px 4px rgba(26,35,126,0.06);
        padding: 1.25rem 1rem;
        margin-bottom: 1.5rem;
      }
    </style>
  </head>
  <body>
    <div class="d-flex flex-column flex-lg-row min-vh-100">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="text-center mb-4">
          <h4 class="text-white">Admin Panel</h4>
        </div>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="/admin">
              <i class="bi bi-speedometer2"></i> Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/admission">
              <i class="bi bi-person-plus"></i> Admissions
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/student">
              <i class="bi bi-mortarboard"></i> Students
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/teacher">
              <i class="bi bi-person-workspace"></i> Teachers
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/notice">
              <i class="bi bi-megaphone"></i> Notices
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/payments">
              <i class="bi bi-credit-card"></i> Payments
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/login/logout">
              <i class="bi bi-box-arrow-right"></i> Logout
            </a>
          </li>
        </ul>
      </div>
      <!-- Main Content -->
      <main class="main-content flex-grow-1">
        <div class="container-fluid">
          <div class="section mb-4">
            <h2 class="mb-4 fw-bold">Dashboard</h2>
            <!-- Stats Row -->
            <div class="row g-3 mb-4">
              <div class="col-6 col-md-3 col-lg-2">
                <div class="stat-card p-3" style="min-width:110px; min-height:110px;">
                  <div class="icon text-primary mb-1" style="font-size:1.5rem;">
                    <i class="bi bi-mortarboard"></i>
                  </div>
                  <div class="stat-value" style="font-size:1.3rem;"><%= Students.length %></div>
                  <div class="stat-label" style="font-size:0.95rem;">Students</div>
                </div>
              </div>
              <div class="col-6 col-md-3 col-lg-2">
                <div class="stat-card p-3" style="min-width:110px; min-height:110px;">
                  <div class="icon text-success mb-1" style="font-size:1.5rem;">
                    <i class="bi bi-person-workspace"></i>
                  </div>
                  <div class="stat-value" style="font-size:1.3rem;"><%= Teachers.length %></div>
                  <div class="stat-label" style="font-size:0.95rem;">Teachers</div>
                </div>
              </div>
              <div class="col-6 col-md-3 col-lg-2">
                <div class="stat-card p-3" style="min-width:110px; min-height:110px;">
                  <div class="icon text-warning mb-1" style="font-size:1.5rem;">
                    <i class="bi bi-file-earmark-text"></i>
                  </div>
                  <div class="stat-value" style="font-size:1.3rem;"><%= pendingAdmissions.length %></div>
                  <div class="stat-label" style="font-size:0.95rem;">Admissions</div>
                </div>
              </div>
              <div class="col-6 col-md-3 col-lg-2">
                <div class="stat-card p-3" style="min-width:110px; min-height:110px;">
                  <div class="icon text-info mb-1" style="font-size:1.5rem;">
                    <i class="bi bi-calendar-event"></i>
                  </div>
                  <div class="stat-value" style="font-size:1.3rem;"><%= ActiveNotice.length %></div>
                  <div class="stat-label" style="font-size:0.95rem;">Notices</div>
                </div>
              </div>
            </div>
            <!-- Notices & Admissions Row -->
            <div class="row g-4">
              <div class="col-12 col-lg-6">
                <h3 class="mb-3 fw-semibold">Recent Notices</h3>
                <% let hasActiveNotice = false; %>
                <% Notice.forEach(function(notice) { if(notice.status === "Active") hasActiveNotice = true; }); %>
                <% if (hasActiveNotice) { %>
                  <% Notice.forEach(function(notice) { if(notice.status === "Active") { %>
                    <div class="notice-card">
                      <div class="notice-title"><%= notice.title %></div>
                      <div class="notice-content"><%= notice.remark %></div>
                      <div class="notice-date">Date: <%= notice.date %></div>
                    </div>
                  <% } }); %>
                <% } else { %>
                  <div class="notice-card text-center">
                    <a href="/admin/notice" class="nav-link">No active notices. Click here to add a new notice.</a>
                  </div>
                <% } %>
              </div>
              <div class="col-12 col-lg-6">
                <h3 class="mb-3 fw-semibold">Pending Admissions</h3>
                <div class="data-table">
                  <div class="table-responsive">
                    <table class="table table-striped align-middle">
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Class</th>
                          <th>Date</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% let hasPendingAdmission = false; %>
                        <% Admissions.forEach(function(admission) { if (admission.status === "Pending") { hasPendingAdmission = true; %>
                        <tr>
                          <td><%= admission.name %> <%= admission.lastname %></td>
                          <td><%= admission.grade %></td>
                          <td><%= admission.createdAt %></td>
                          <td>
                            <span class="badge bg-warning"><%= admission.status %></span>
                          </td>
                        </tr>
                        <% } }); %>
                        <% if (!hasPendingAdmission) { %>
                        <tr>
                          <td colspan="4" class="text-center text-muted">No pending admissions</td>
                        </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <!-- Teacher Leave Applications -->
            <div class="row g-4">
              <div class="col-12 mt-4">
                <h3 class="mb-3 fw-semibold">Teacher Leave Applications</h3>
                <div class="leave-table">
                  <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                      <thead>
                        <tr>
                          <th>Teacher ID</th>
                          <th>From Date</th>
                          <th>To Date</th>
                          <th>Reason</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% let hasLeave = false; %>
                        <% TeacherLeaves.forEach(function(leave) { hasLeave = true; %>
                        <tr data-leave-id="<%= leave._id %>">
                          <td><strong><%= leave.teacherId %></strong></td>
                          <td><%= new Date(leave.fromDate).toLocaleDateString() %></td>
                          <td><%= new Date(leave.toDate).toLocaleDateString() %></td>
                          <td><%= leave.reason %></td>
                          <td>
                            <span class="leave-status-badge <%= leave.status.toLowerCase() %>"><%= leave.status %></span>
                          </td>
                          <td>
                            <% if(leave.status === 'Pending') { %>
                            <div class="leave-actions">
                              <div class="btn-group" role="group">
                                <button type="button" class="btn btn-success btn-sm" onclick="approveLeave('<%= leave._id %>')" title="Approve Leave">
                                  <i class="bi bi-check-circle"></i> Approve
                                </button>
                                <button type="button" class="btn btn-danger btn-sm" onclick="rejectLeave('<%= leave._id %>')" title="Reject Leave">
                                  <i class="bi bi-x-circle"></i> Reject
                                </button>
                              </div>
                            </div>
                            <% } else { %>
                            <span class="text-muted">No actions available</span>
                            <% } %>
                          </td>
                        </tr>
                        <% }); %>
                        <% if (!hasLeave) { %>
                        <tr>
                          <td colspan="6" class="text-center text-muted">No teacher leave applications</td>
                        </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script src="/js/responsive.js"></script>
    <script src="/js/admin/admin.js"></script>
  </body>
</html>
